# DiagAF
DiagAF is a more accurate and efficient pre-alignment filter for sequence alignment. It can efficiently filter out candidates that contain errors greater than the edit distance threshold during read mapping. Compared with state-of-art methods, DiagAF has the features: 1) faster; 2) lower false positive rate; 3) zero false negative rate; 4) can deal with alignments with un-equal lengths; 5) can pre-align a  string to multiple candidate in a single time run.

DiagAF is limited for dealing with string using edit distance now. DiagAF uses a new lower bound of edit distance based on shift hamming masks. The new lower bound makes use of fewer shift hamming masks. DiagAF can deal with data pairs in different lengths, which makes DiagAF have more usage scenarios in practical applications. DiagAF is the implementation based on SHD codes(https://github.com/CMU-SAFARI/Shifted-Hamming-Distance). Now,DiagAF is also based on the Intel SSE instruction set, so the maximum data pair length is 128. In the future, we would generalize DiagAF on other SIMD computational platforms such as GPU and FPGA.

Building notes

Our directory contains two part of content : 1.code to build the pair needed using primiartive dataset 2.code revised from SHD to accomplish our function

First directory named #PairGenCode# consisted of the code necessary to generate the pair data.
To generate the pair,firstly,change the directory to PairGenCode and type

	$ make

then you need to download the primiartive dataset with format fastq and place it in current directory.

 	$./GenSHDPair_1delins DATASET $j

Assuming DATASET is the primiartive dataset downloaded and with the above instructions you can generate the data pair of the specified edit distance(j) you want.
The data generated by #GenSHDPair_1delins# is consisted of at most one pair of insertion and deletion.The remaining editing operations are all substitutions.
The data generated by #GenPair1sub# is consisted of paired insertion and deletion and at most has one substitution.The above two operations generate data pairs with equal length.
The data pair generated by #GenPairunequal# consists of random insertion, deletion, and substitution, and the generated pairs are not necessarily equal in length.

We also provide the function to check whether the edit distance of data pair generated equal to the set value.
You can run the following program by this command:

	$./PairEdConfirm -r PAIRDATA -e $j 

And to make sure the data is correct so that we can focus on next step.By the way,the program has two parameter,the path of data pair is following the "-r";""-e" to input the edit distance you want，
If edit distance of data pair is different with parameter following "-e",the program will interrupt and print the error message.

Second directory named #SHDCode# consisted of our revised implemention of SHD i.e. #DiagAF#.
Same as the first directory, just enter the directory and run：

	$ make

After that,you can type command to run a test using DiagAF,:

	$ ./TestInputPair <edit-distance threshold T>  <method-selection S>

Then type in string pairs that are sent to DiagAF. Strings are delineated by a *new line (\n)* character.
Enter "end_of_file" to end the program.Typing 1 to 4 corresponding to SHD,SHD_hf,DiagAF,DiagAF_DB.
By run "$make" command, the executable program named "FPEXEC" and "FNEXEC" will be construsted either.The former is used to test the false positive rate and another is for false negative rate.

	$./FPEXEC data_${k}_ed_${j} ${i} $m
	
You can enter the above command to test the number of data pairs passed through the filter of a data file.The first parameter is the file name of the data pair, the second parameter is the threshold T,
and the last parameter is the method of your selection.Typing 1 to 4 corresponding to SHD,SHD_hf,DiagAF,DiagAF_DB.
We also provide the shell script we used as reference i.e. whose name end with ".sh".Their content is easy to understand and you can modify the script file to get your desired test results.
Our file directory hierarchy as follows you can run the test in the same way.

Pair_1delins  
│   ├── data_1  
│   ├── data_1_ed_1  
│   ├── data_1_ed_2  
│   ├── data_1_ed_3  
│   ├── data_1_ed_4  
│   ├── data_1_ed_5  
│   ├── data_1_ed_6  
│   ├── data_1_ed_7  
│   ├── data_1_ed_8  
│   ├── data_1_ed_9  
│   ├── data_1_ed_10  
│   ├── data_1_ed_11  
│   ├── data_1_ed_12  
│   ├── data_1_ed_13  
│   ├── data_1_ed_14  
│   ├── data_1_ed_15  
│   ├── EdCondirm_1  
│   ├── EdDistribution  
│   │   └── EdDistribution_1  
│   ├── Exp_Rslt  
│   │   ├── FN  
│   │   │   ├── Method1Data1Rslt  
│   │   │   ├── Method2Data1Rslt  
│   │   │   ├── Method3Data1Rslt  
│   │   │   └── Method4Data1Rslt  
│   │   └── FP  
│   │       ├── Method1Data1Rslt  
│   │       ├── Method2Data1Rslt  
│   │       ├── Method3Data1Rslt  
│   │       └── Method4Data1Rslt  
│   ├── FNEXEC  
│   ├── FN.sh  
│   ├── FPEXEC  
│   ├── FP.sh  
│   ├── GenSHDPair_1delins  
│   ├── GenSHDPair_1delins.sh  
│   ├── PairEdConfirm  
│   └── PairEdConfirm.sh  
